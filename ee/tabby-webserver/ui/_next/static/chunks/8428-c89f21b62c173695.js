"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8428],{98428:function(e,n,l){l.d(n,{e:function(){return eh},p:function(){return ev}});var t=l(36164),s=l(3546),r=l(54549),a=l(63484),i=l(74248),o=l(31458),c=l(81565),d=l(62940);function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0,[l,t]=s.useState(!1);return s.useEffect(()=>{if(n)return;let l=(0,d.Z)(()=>{t(window.innerHeight+window.scrollY>=document.body.offsetHeight-e)},100,{leading:!0});return window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",l,{passive:!0}),l(),()=>{window.removeEventListener("scroll",l),window.removeEventListener("resize",l)}},[e,n]),s.useEffect(()=>{if(!n)return;let l=(0,d.Z)(()=>{let{scrollTop:l,clientHeight:s,scrollHeight:r}=n;t(l+s>=r-e)},100,{leading:!0});return n.addEventListener("scroll",l,{passive:!0}),n.addEventListener("resize",l,{passive:!0}),l(),()=>{n.removeEventListener("scroll",l),n.removeEventListener("resize",l)}},[e,n]),l}function m(e){let{className:n,container:l,offset:s,...r}=e,a=u(s||0,l);return(0,t.jsxs)(o.z,{variant:"outline",size:"icon",className:(0,i.cn)("absolute right-4 top-1 z-10 bg-background transition-opacity duration-300 sm:right-8 md:top-2",a?"opacity-0":"opacity-100",n),onClick:()=>{l?l.scrollTo({top:l.scrollHeight,behavior:"smooth"}):window.scrollTo({top:document.body.offsetHeight,behavior:"smooth"})},...r,children:[(0,t.jsx)(c.IconArrowDown,{}),(0,t.jsx)("span",{className:"sr-only",children:"Scroll to bottom"})]})}var v=l(45391),h=l(34021),f=l(21454),x=l(3765),p=l(84942),g=l(29),j=l(95623);let b=s.forwardRef(function(e,n){let{onSubmit:l,input:r,setInput:a,isLoading:d}=e,{formRef:u,onKeyDown:m}=function(){let e=(0,s.useRef)(null);return{formRef:e,onKeyDown:n=>{if("Enter"===n.key&&!n.shiftKey&&!n.nativeEvent.isComposing){var l;null===(l=e.current)||void 0===l||l.requestSubmit(),n.preventDefault()}}}}(),[b,y]=s.useState(null),[k,C]=s.useState(!1),E=s.useRef(null),S=s.useRef(),R=s.useRef(),[z,I]=s.useState([]),[L,_]=s.useState({}),{data:F}=(0,f.ZP)(b,x.Z,{revalidateOnFocus:!1,dedupingInterval:0,errorRetryCount:0});s.useEffect(()=>{var e;let n=null!==(e=null==F?void 0:F.hits)&&void 0!==e?e:[];I(n),C(!!(null==n?void 0:n.length))},[null==F?void 0:F.hits]),s.useImperativeHandle(n,()=>({focus:()=>{var e;null===(e=E.current)||void 0===e||e.focus()}})),s.useEffect(()=>{r&&E.current&&E.current!==document.activeElement&&E.current.focus()},[r]),s.useLayoutEffect(()=>{var e,n,l;(null===(e=R.current)||void 0===e?void 0:e.length)&&(null===(l=E.current)||void 0===l||null===(n=l.setSelectionRange)||void 0===n||n.call(l,R.current[0],R.current[1]),R.current=void 0)}),s.useMemo(()=>(0,v.Z)(e=>{var n,l,t,s;let r=null!==(t=null===(n=e.target)||void 0===n?void 0:n.value)&&void 0!==t?t:"",a=null!==(s=null===(l=e.target)||void 0===l?void 0:l.selectionEnd)&&void 0!==s?s:0,i=w(r,a),o=null==i?void 0:i[1];if(o){let e=encodeURIComponent("name:".concat(o," AND kind:function")),n="/v1beta/search?q=".concat(e);y(n)}else I([]),C(!1)},200),[]);let D=async e=>{if(e.preventDefault(),!(null==r?void 0:r.trim())||d)return;let n=r;Object.keys(L).forEach(e=>{var l,t,s;let r=L[e];(null==r?void 0:r.doc)&&(n=n.replaceAll(e,"\n```".concat(null!==(t=null===(l=r.doc)||void 0===l?void 0:l.language)&&void 0!==t?t:"","\n").concat(null!==(s=r.doc.body)&&void 0!==s?s:"","\n","```","\n")))}),a(""),await l(n)},Z=(e,n)=>{"Enter"===e.key&&n?e.preventDefault():n&&["ArrowRight","ArrowLeft","Home","End"].includes(e.key)?(I([]),C(!1)):(n||(e.preventDownshiftDefault=!0),m(e))};return(0,t.jsx)("form",{onSubmit:D,ref:u,children:(0,t.jsx)(j.Vc,{options:z,onSelect:e=>{var n,l,t;let s=null!==(n=S.current)&&void 0!==n?n:0,i=w(r,s);if(i){_({...L,["@".concat(null===(l=e.doc)||void 0===l?void 0:l.name)]:e});let n="@".concat(null==e?void 0:null===(t=e.doc)||void 0===t?void 0:t.name," "),o=r.substring(0,s).replace(new RegExp(i[0]),""),c=o.length+n.length;R.current=[c,c],a(o+n+r.slice(s))}I([]),C(!1)},open:k,onOpenChange:e=>{e&&(null==z?void 0:z.length)?C(e):(C(!1),I([]))},children:e=>{var n,l,s,u;let{open:m,highlightedIndex:v}=e,f=null==z?void 0:z[v];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.JH,{children:(0,t.jsxs)("div",{className:"relative flex max-h-60 w-full grow flex-col overflow-hidden bg-background px-8 sm:rounded-md sm:border sm:px-12",children:[(0,t.jsx)("span",{className:(0,i.cn)((0,o.d)({size:"sm",variant:"ghost"}),"absolute left-0 top-4 h-8 w-8 rounded-full bg-background p-0 hover:bg-background sm:left-4"),children:(0,t.jsx)(c.IconEdit,{})}),(0,t.jsx)(j.rG,{tabIndex:0,rows:1,placeholder:"Ask a question.",spellCheck:!1,className:"min-h-[60px] w-full resize-none bg-transparent px-4 py-[1.3rem] focus-within:outline-none",value:r,ref:E,onChange:e=>{(0,h.Z)(e,"target.value")?(S.current=e.target.selectionEnd,a(e.target.value)):S.current=void 0},onKeyDown:e=>Z(e,m)}),(0,t.jsx)("div",{className:"absolute right-0 top-4 sm:right-4",children:(0,t.jsxs)(g.u,{children:[(0,t.jsx)(g.aJ,{asChild:!0,children:(0,t.jsxs)(o.z,{type:"submit",size:"icon",disabled:d||""===r,children:[(0,t.jsx)(c.IconArrowElbow,{}),(0,t.jsx)("span",{className:"sr-only",children:"Send message"})]})}),(0,t.jsx)(g._v,{children:"Send message"})]})})]})}),(0,t.jsx)(j.fD,{align:"start",side:"top",onOpenAutoFocus:e=>e.preventDefault(),className:"w-[60vw] md:w-[430px]",children:(0,t.jsxs)(p.J2,{open:m&&!!f,children:[(0,t.jsx)(p.tW,{asChild:!0,children:(0,t.jsx)("div",{className:"max-h-[300px] overflow-y-scroll",children:m&&!!(null==z?void 0:z.length)&&z.map((e,n)=>{var l,s,r;return(0,t.jsx)(j.x5,{item:e,index:n,children:(0,t.jsxs)("div",{className:"flex w-full items-center justify-between gap-8 overflow-x-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(N,{kind:null==e?void 0:null===(l=e.doc)||void 0===l?void 0:l.kind}),(0,t.jsxs)("div",{className:"max-w-[200px] truncate",children:[null==e?void 0:null===(s=e.doc)||void 0===s?void 0:s.name,"(...)"]})]}),(0,t.jsx)("div",{className:"flex-1 truncate text-right text-sm text-muted-foreground",children:null==e?void 0:null===(r=e.doc)||void 0===r?void 0:r.body})]})},null==e?void 0:e.id)})})}),(0,t.jsx)(p.yk,{asChild:!0,align:"start",side:"right",alignOffset:-4,onOpenAutoFocus:e=>e.preventDefault(),onKeyDownCapture:e=>e.preventDefault(),className:"rounded-none",collisionPadding:{bottom:120},children:(0,t.jsxs)("div",{className:"flex max-h-[70vh] w-[20vw] flex-col overflow-y-auto px-2 md:w-[240px] lg:w-[340px]",children:[(0,t.jsxs)("div",{className:"mb-2",children:[(null==f?void 0:null===(n=f.doc)||void 0===n?void 0:n.kind)?"(".concat(null==f?void 0:null===(l=f.doc)||void 0===l?void 0:l.kind,") "):"",null==f?void 0:null===(s=f.doc)||void 0===s?void 0:s.name]}),(0,t.jsx)("div",{className:"flex-1 whitespace-pre-wrap break-all text-muted-foreground",children:null==f?void 0:null===(u=f.doc)||void 0===u?void 0:u.body})]})})]})})]})}})})});function w(e,n){let l=e.substring(0,n),t=/@(\w+)$/.exec(l);return t}function N(e){let{kind:n,...l}=e;return(0,t.jsx)(c.IconSymbolFunction,{...l})}function y(e){let{href:n,children:l}=e;return(0,t.jsxs)("a",{href:n,target:"_blank",className:"inline-flex flex-1 justify-center gap-1 leading-4 hover:underline",children:[(0,t.jsx)("span",{children:l}),(0,t.jsx)("svg",{"aria-hidden":"true",height:"7",viewBox:"0 0 6 6",width:"7",className:"opacity-70",children:(0,t.jsx)("path",{d:"M1.25215 5.54731L0.622742 4.9179L3.78169 1.75597H1.3834L1.38936 0.890915H5.27615V4.78069H4.40513L4.41109 2.38538L1.25215 5.54731Z",fill:"currentColor"})})]})}function k(e){let{className:n,...l}=e;return(0,t.jsxs)("p",{className:(0,i.cn)("px-2 text-center text-xs leading-normal text-muted-foreground",n),...l,children:[(0,t.jsx)(y,{href:"https://tabby.tabbyml.com",children:"Tabby"}),", an opensource, self-hosted AI coding assistant ."]})}function C(e){let{id:n,stop:l,reload:r,input:a,setInput:i,className:d,onSubmit:u,chatMaxWidthClass:v}=e,h=s.useRef(null),{container:f,onClearMessages:x,qaPairs:p,isLoading:g}=s.useContext(ev);return s.useEffect(()=>{var e;null==h||null===(e=h.current)||void 0===e||e.focus()},[n]),(0,t.jsxs)("div",{className:d,children:[(0,t.jsx)(m,{container:f}),(0,t.jsxs)("div",{className:"mx-auto md:px-4 ".concat(v),children:[(0,t.jsxs)("div",{className:"flex h-10 items-center justify-center gap-2",children:[g?(0,t.jsxs)(o.z,{variant:"outline",onClick:()=>l(),className:"bg-background",children:[(0,t.jsx)(c.IconStop,{className:"mr-2"}),"Stop generating"]}):(null==p?void 0:p.length)>0&&(0,t.jsxs)(o.z,{variant:"outline",onClick:()=>r(),className:"bg-background",children:[(0,t.jsx)(c.IconRefresh,{className:"mr-2"}),"Regenerate response"]}),(null==p?void 0:p.length)>0&&(0,t.jsxs)(o.z,{variant:"outline",onClick:x,className:"bg-background lg:hidden",children:[(0,t.jsx)(c.IconTrash,{className:"mr-2"}),"Clear"]})]}),(0,t.jsxs)("div",{className:"space-y-4 border-t bg-background px-4 py-2 shadow-lg sm:rounded-t-xl sm:border md:py-4",children:[(0,t.jsx)(b,{ref:h,onSubmit:u,input:a,setInput:i,isLoading:g}),(0,t.jsx)(k,{className:"hidden sm:block"})]})]})]})}var E=l(76297);function S(e){let{trackVisibility:n}=e,{container:l}=s.useContext(ev),r=u(100,l),{ref:a,entry:i,inView:o}=(0,E.YD)({trackVisibility:n,delay:100,rootMargin:"0px 0px -150px 0px",root:l});return s.useEffect(()=>{r&&n&&!o&&(null==i||i.target.scrollIntoView({block:"start"}))},[o,i,r,n]),(0,t.jsx)("div",{ref:a,className:"h-px w-full"})}let R=[{heading:"Convert list of string to numbers",message:"How to convert a list of string to numbers in python"},{heading:"How to parse email address",message:"How to parse email address with regex"}];function z(e){let{setInput:n,chatMaxWidthClass:l,welcomeMessage:s}=e;return(0,t.jsx)("div",{className:"mx-auto px-4 ".concat(l),children:(0,t.jsxs)("div",{className:"rounded-lg border bg-background p-8",children:[(0,t.jsx)("h1",{className:"mb-2 text-lg font-semibold",children:s||"Welcome"}),(0,t.jsx)("p",{className:"leading-normal text-muted-foreground",children:"You can start a conversation here or try the following examples:"}),(0,t.jsx)("div",{className:"mt-4 flex flex-col items-start space-y-2",children:R.map((e,l)=>(0,t.jsxs)(o.z,{variant:"link",className:"h-auto p-0 text-base",onClick:()=>n(e.message),children:[(0,t.jsx)(c.IconArrowRight,{className:"mr-2 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-left",children:e.heading})]},l))})]})})}var I=l(42891),L=l.n(I),_=l(23342),F=l(74630),D=l(64148),Z=l(93668),H=l(73162),M=l(83008),A=l(28312);let T={javascript:".js",python:".py",java:".java",c:".c",cpp:".cpp","c++":".cpp","c#":".cs",ruby:".rb",php:".php",swift:".swift","objective-c":".m",kotlin:".kt",typescript:".ts",go:".go",perl:".pl",rust:".rs",scala:".scala",haskell:".hs",lua:".lua",shell:".sh",sql:".sql",html:".html",css:".css"},O=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l="ABCDEFGHJKLMNPQRSTUVWXY3456789",t="";for(let n=0;n<e;n++)t+=l.charAt(Math.floor(Math.random()*l.length));return n?t.toLowerCase():t},U=(0,s.memo)(e=>{let{language:n,value:l}=e,{isCopied:s,copyToClipboard:r}=(0,A.m)({timeout:2e3});return(0,t.jsxs)("div",{className:"codeblock relative w-full bg-zinc-950 font-sans",children:[(0,t.jsxs)("div",{className:"flex w-full items-center justify-between bg-zinc-800 px-6 py-2 pr-4 text-zinc-100",children:[(0,t.jsx)("span",{className:"text-xs lowercase",children:n}),(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsxs)(o.z,{variant:"ghost",className:"hover:bg-[#3C382F] hover:text-[#F4F4F5] focus-visible:ring-1 focus-visible:ring-slate-700 focus-visible:ring-offset-0",onClick:()=>{let e=T[n]||".file",t="file-".concat(O(3,!0)).concat(e),s=window.prompt("Enter file name",t);if(!s)return;let r=new Blob([l],{type:"text/plain"}),a=URL.createObjectURL(r),i=document.createElement("a");i.download=s,i.href=a,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)},size:"icon",children:[(0,t.jsx)(c.IconDownload,{}),(0,t.jsx)("span",{className:"sr-only",children:"Download"})]}),(0,t.jsxs)(o.z,{variant:"ghost",size:"icon",className:"text-xs hover:bg-[#3C382F] hover:text-[#F4F4F5] focus-visible:ring-1 focus-visible:ring-slate-700 focus-visible:ring-offset-0",onClick:()=>{s||r(l)},children:[s?(0,t.jsx)(c.IconCheck,{}):(0,t.jsx)(c.IconCopy,{}),(0,t.jsx)("span",{className:"sr-only",children:"Copy code"})]})]})]}),(0,t.jsx)(H.Z,{language:n,style:M.RY,PreTag:"div",showLineNumbers:!0,customStyle:{margin:0,width:"100%",background:"transparent",padding:"1.5rem 1rem"},codeTagProps:{style:{fontSize:"0.9rem",fontFamily:"var(--font-mono)"}},children:l})]})});U.displayName="CodeBlock";var Y=l(73033),P=l(48537),q=l(43739),J=l(14079);let V=q.fC,W=s.forwardRef((e,n)=>{let{className:l,...s}=e;return(0,t.jsx)(q.ck,{ref:n,className:(0,i.cn)("border-b",l),...s})});W.displayName="AccordionItem";let B=s.forwardRef((e,n)=>{let{className:l,children:s,...r}=e;return(0,t.jsxs)(q.xz,{ref:n,className:(0,i.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",l),...r,children:[s,(0,t.jsx)(J.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})});B.displayName=q.xz.displayName;let K=s.forwardRef((e,n)=>{let{className:l,children:s,...r}=e;return(0,t.jsx)(q.VY,{ref:n,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:(0,t.jsx)("div",{className:(0,i.cn)("pb-4 pt-0",l),children:s})})});K.displayName=q.VY.displayName;var $=l(11208),G=l(3448),Q=l(52569);function X(e){let{messages:n,chatMaxWidthClass:l}=e,{isLoading:r}=s.useContext(ev);return(0,t.jsx)("div",{className:"relative mx-auto px-4 ".concat(l),children:null==n?void 0:n.map((e,l)=>{let a=l===n.length-1;return(0,t.jsxs)(s.Fragment,{children:[(0,t.jsx)(ee,{isLoading:!!a&&r,message:e}),!a&&(0,t.jsx)($.Z,{className:"my-4 md:my-8"})]},e.user.id)})})}function ee(e){let{message:n,isLoading:l}=e,{user:s,assistant:r}=n,a=s.selectContext,i=s.relevantContext;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(en,{message:s}),!!r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($.Z,{className:"my-4 md:my-8"}),(0,t.jsx)(el,{message:r,isLoading:l,userMessageId:s.id,selectContext:a,relevantContext:i})]})]})}function en(e){let{message:n}=e,{handleMessageAction:l}=s.useContext(ev),r=n.selectContext,d=s.useMemo(()=>{var e,n;if(!(null==r?void 0:r.content))return"";let l=(null==r?void 0:r.filepath)&&null!==(e=(0,a.U$)(null==r?void 0:r.filepath)[0])&&void 0!==e?e:"";return"\n```".concat(l,"\n").concat(null!==(n=null==r?void 0:r.content)&&void 0!==n?n:"","\n","```","\n")},[r]);return(0,t.jsxs)("div",{className:(0,i.cn)("group relative mb-4 flex items-start md:-ml-4"),...e,children:[(0,t.jsx)("div",{className:"shrink-0 select-none rounded-full border bg-background shadow",children:(0,t.jsx)(Q.Y,{className:"h-8 w-8",fallback:(0,t.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,t.jsx)(c.IconUser,{className:"h-5 w-5"})})})}),(0,t.jsxs)("div",{className:"ml-4 flex-1 space-y-2 overflow-hidden px-1",children:[(0,t.jsx)(et,{message:n.message}),!!d&&(0,t.jsx)(et,{message:d}),(0,t.jsx)(ei,{children:(0,t.jsxs)(o.z,{variant:"ghost",size:"icon",onClick:e=>null==l?void 0:l(n.id,"delete"),children:[(0,t.jsx)(c.IconTrash,{}),(0,t.jsx)("span",{className:"sr-only",children:"Delete message"})]})})]})]})}function el(e){let{handleMessageAction:n,isLoading:l}=s.useContext(ev),{message:r,selectContext:a,relevantContext:d,isLoading:u,userMessageId:m,...v}=e,h=s.useMemo(()=>{var e,n;return null!==(n=null==r?void 0:null===(e=r.relevant_code)||void 0===e?void 0:e.map(e=>{var n;let l=null!==(n=null==e?void 0:e.start_line)&&void 0!==n?n:0,t=e.body.split("\n").length;return{kind:"file",range:{start:l,end:l+t-1},filepath:e.filepath,content:e.body,git_url:e.git_url}}))&&void 0!==n?n:[]},[null==r?void 0:r.relevant_code]);return(0,t.jsxs)("div",{className:(0,i.cn)("group relative mb-4 flex items-start md:-ml-4"),...v,children:[(0,t.jsx)("div",{className:"shrink-0 select-none rounded-full border bg-background shadow",children:(0,t.jsx)(ea,{className:"h-8 w-8"})}),(0,t.jsxs)("div",{className:"ml-4 flex-1 space-y-2 overflow-hidden px-1",children:[(0,t.jsx)(eo,{contexts:h}),!u||(null==r?void 0:r.message)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(et,{message:r.message}),!!r.error&&(0,t.jsx)(es,{error:r.error})]}):(0,t.jsx)(er,{}),(0,t.jsxs)(ei,{children:[!l&&(0,t.jsxs)(o.z,{variant:"ghost",size:"icon",onClick:e=>n(m,"regenerate"),children:[(0,t.jsx)(c.IconRefresh,{}),(0,t.jsx)("span",{className:"sr-only",children:"Regenerate message"})]}),(0,t.jsx)(P.q,{value:r.message})]})]})]})}function et(e){let{message:n}=e;return(0,t.jsx)(Y.s,{className:"prose max-w-none break-words dark:prose-invert prose-p:leading-relaxed prose-pre:mt-1 prose-pre:p-0",remarkPlugins:[D.Z,Z.Z],components:{p(e){let{children:n}=e;return(0,t.jsx)("p",{className:"mb-2 last:mb-0",children:n})},code(e){var n;let{node:l,inline:s,className:r,children:a,...i}=e;if(a.length){if("▍"==a[0])return(0,t.jsx)("span",{className:"mt-1 animate-pulse cursor-default",children:"▍"});a[0]=a[0].replace("`▍`","▍")}let o=/language-(\w+)/.exec(r||""),c=function(e){let n={};if(!e)return n;let l=e.split(" ");return l.forEach(e=>{let[l,t]=e.split("=");n[l]=t}),n}(null===(n=l.data)||void 0===n?void 0:n.meta),d=(null==c?void 0:c.is_reference)==="1";return d?null:s?(0,t.jsx)("code",{className:r,...i,children:a}):(0,t.jsx)(U,{language:o&&o[1]||"",value:String(a).replace(/\n$/,""),...i},Math.random())}},children:n})}function es(e){let{error:n="Fail to fetch"}=e,l=s.useMemo(()=>"```\n"+JSON.stringify({error:!0,message:n},null,2)+"\n```",[n]);return(0,t.jsx)(Y.s,{className:"prose break-words text-sm dark:prose-invert prose-p:leading-relaxed prose-pre:mt-1 prose-pre:p-0",remarkPlugins:[D.Z,Z.Z],components:{code(e){let{node:n,inline:l,className:s,children:r,...a}=e;return(0,t.jsx)("div",{...a,className:(0,i.cn)(s,"bg-zinc-950 p-2"),children:r})}},children:l})}function er(){return(0,t.jsxs)("div",{className:"space-y-2 px-1",children:[(0,t.jsx)(G.O,{className:"h-3 w-full"}),(0,t.jsx)(G.O,{className:"h-3 w-full"})]})}function ea(e){let{className:n}=e;return(0,t.jsx)(L(),{style:{backgroundColor:"#E8E2D2"},className:(0,i.cn)("rounded-full p-0.5",n),src:_.Z,alt:"tabby"})}function ei(e){let{className:n,...l}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex items-center justify-end transition-opacity group-hover:opacity-100 md:absolute md:-right-[5rem] md:-top-2 md:opacity-0",n),...l})}let eo=e=>{let{contexts:n}=e,{onNavigateToContext:l}=s.useContext(ev),r=(null==n?void 0:n.length)>1;return(null==n?void 0:n.length)?(0,t.jsx)(V,{type:"single",collapsible:!0,className:"bg-background text-foreground",children:(0,t.jsxs)(W,{value:"references",className:"my-0 border-0",children:[(0,t.jsx)(B,{className:"my-0 py-2",children:(0,t.jsx)("span",{className:"mr-2",children:"Read ".concat(n.length," file").concat(r?"s":"")})}),(0,t.jsx)(K,{className:"space-y-2",children:null==n?void 0:n.map((e,n)=>{var s,r,a;let i=!(0,F.Z)(null===(s=e.range)||void 0===s?void 0:s.start)&&!(0,F.Z)(null===(r=e.range)||void 0===r?void 0:r.end)&&e.range.start<e.range.end,o=e.filepath.split("/"),d=o[o.length-1],u=o.slice(0,o.length-1).join("/");return(0,t.jsx)("div",{className:"cursor-pointer rounded-md border p-2 hover:bg-accent",onClick:n=>null==l?void 0:l(e),children:(0,t.jsxs)("div",{className:"flex items-center gap-1 overflow-x-auto",children:[(0,t.jsx)(c.IconFile,{className:"shrink-0"}),(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{children:d}),(null===(a=e.range)||void 0===a?void 0:a.start)&&(0,t.jsxs)("span",{className:"text-muted-foreground",children:[":",e.range.start]}),i&&(0,t.jsxs)("span",{className:"text-muted-foreground",children:["-",e.range.end]})]}),(0,t.jsx)("span",{className:"ml-2 text-xs text-muted-foreground",children:u})]})},n)})})]})}):null};var ec=l(15696),ed=l(16784),eu=l(24449),em=l(90379);let ev=s.createContext({}),eh=s.forwardRef(function(e,n){let{className:l,chatId:o,initialMessages:c,headers:d,api:u="/v1beta/answer",onLoaded:m,onThreadUpdates:v,onNavigateToContext:h,container:f,fetcher:x,docQuery:p,generateRelevantQuestions:g,maxWidth:j,welcomeMessage:b}=e,[w,N]=s.useState(!1),y=s.useRef(!1),[k,E]=s.useState(null!=c?c:[]),[R,I]=s.useState(""),{triggerRequest:L,isLoading:_,error:F,answer:D,stop:Z}=function(e){let{api:n="/v1beta/answer",onError:l,headers:t,fetcher:r}=e,[a,i]=s.useState(!1),[o,c]=s.useState(),[d,u]=s.useState(),m=s.useRef(null),v=e=>{if("event"===e.type&&"data"in e){let n=JSON.parse(e.data);n&&c(e=>h(e,n))}},h=(e,n)=>{var l,t;return e?{...e,answer_delta:"".concat(null!==(l=null==e?void 0:e.answer_delta)&&void 0!==l?l:"").concat(null!==(t=null==n?void 0:n.answer_delta)&&void 0!==t?t:"")}:n},f=async e=>{try{i(!0),u(void 0),c(void 0);let l=new AbortController;m.current=l;let s=null!=r?r:window.fetch,a=await s(n,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",...t},signal:null==l?void 0:l.signal}).catch(e=>{throw e});if(!(null==a?void 0:a.ok))throw Error(String(a.status));if(null==a.body)throw Error("The response body is empty");let o=a.body.pipeThrough(new TextDecoderStream).pipeThrough(new ec.m).getReader();for(;;){let{done:e,value:n}=await o.read();if(e)break;v(n)}}catch(e){if((null==e?void 0:e.name)==="AbortError")return m.current=null,null;l&&e instanceof Error&&l(e),u(e)}finally{i(!1)}};return{isLoading:a,answer:o,error:d,setError:u,triggerRequest:f,stop:()=>{m.current&&(m.current.abort(),m.current=null)}}}({api:u,headers:d,fetcher:x}),H=async e=>{Z();let n=k.filter(n=>n.user.id!==e);E(n)},M=async e=>{let n=(0,r.Z)(k,n=>n.user.id===e);if(n>-1){var l;let e=k[n],t=[...k.slice(0,n),{...e,assistant:{...e.assistant,id:(null===(l=e.assistant)||void 0===l?void 0:l.id)||(0,i.x0)(),message:"",error:void 0}}];return E(t),L(O(t))}},A=async()=>{if(!(null==k?void 0:k.length))return;let e=k[k.length-1].user.id;return M(e)};s.useEffect(()=>{if(!_||!(null==k?void 0:k.length)||!D)return;let e=k[k.length-1];E(n=>{var l;let t=n[n.length-1].assistant,s={...t,id:(null==t?void 0:t.id)||(0,i.x0)(),message:null!==(l=D.answer_delta)&&void 0!==l?l:"",error:void 0,relevant_code:null==D?void 0:D.relevant_code};return[...n.slice(0,n.length-1),{...e,assistant:s}]})},[D,_]);let T=(0,eu.S)(()=>{f?f.scrollTo({top:f.scrollHeight,behavior:"smooth"}):window.scrollTo({top:document.body.offsetHeight,behavior:"smooth"})},100);s.useLayoutEffect(()=>{_&&T.run()},[_]),s.useEffect(()=>{F&&(null==k?void 0:k.length)&&E(e=>{var n,l,t;let s=e[e.length-1];return[...e.slice(0,e.length-1),{...s,assistant:{...s.assistant,id:(null===(n=s.assistant)||void 0===n?void 0:n.id)||(0,i.x0)(),message:null!==(t=null===(l=s.assistant)||void 0===l?void 0:l.message)&&void 0!==t?t:"",error:(null==F?void 0:F.message)==="401"?"Unauthorized":"Fail to fetch"}}]})},[F]);let O=e=>{var n,l;let t=e[e.length-1].user,s=null==t?void 0:t.selectContext,r=s?{content:null!==(n=s.content)&&void 0!==n?n:"",filepath:s.filepath,language:s.filepath&&(0,a.U$)(s.filepath)[0]||"text",git_url:null!==(l=null==s?void 0:s.git_url)&&void 0!==l?l:""}:void 0;return{messages:(function(e){if(!(null==e?void 0:e.length))return[];let n=[],l=e.length;for(let t=0;t<e.length;t++){let s=e[t],{user:r,assistant:i}=s;r&&n.push(function(e,n){let{includeTransformedSelectContext:l}=n,{message:t,id:s}=e;return{id:s,role:"user",content:l?t+function(e){var n;if(!e||!e.content)return"";let{content:l,filepath:t}=e,s=null===(n=(0,a.U$)(t))||void 0===n?void 0:n[0];return"\n```".concat(null!=s?s:"","\n").concat(null!=l?l:"","\n","```","\n")}(e.selectContext):t}}(r,{includeTransformedSelectContext:l>1&&t!==l-1})),i&&n.push({role:"assistant",id:i.id,content:i.message})}return n})(e).slice(0,-1),code_query:r,doc_query:!!p,generate_relevant_questions:!!g}},U=(0,ed.d)(async e=>{var n;if(_)return;let l={...e,id:null!==(n=e.id)&&void 0!==n?n:(0,i.x0)()},t=[...k,{user:l,assistant:{id:(0,i.x0)(),message:"",error:void 0}}];return E(t),L(O(t))}),Y=async e=>{var n;return null===(n=U.current)||void 0===n?void 0:n.call(U,e)},P=async e=>Y({message:e});s.useEffect(()=>{y.current&&v(k)},[k]),s.useImperativeHandle(n,()=>({sendUserChat:Y,stop:Z,isLoading:_}),[]),s.useEffect(()=>{y.current||(y.current=!0,null==m||m(),N(!0))},[]);let q=j?"max-w-".concat(j):"max-w-2xl";return w?(0,t.jsx)(ev.Provider,{value:{isLoading:_,qaPairs:k,onNavigateToContext:h,handleMessageAction:(e,n)=>{switch(n){case"delete":H(e);break;case"regenerate":M(e)}},onClearMessages:()=>{Z(),E([])},container:f},children:(0,t.jsx)("div",{className:"flex justify-center overflow-x-hidden",children:(0,t.jsxs)("div",{className:"w-full px-4 ".concat(q),children:[(0,t.jsxs)("div",{className:(0,i.cn)("pb-[200px] pt-4 md:pt-10",l),children:[(null==k?void 0:k.length)?(0,t.jsx)(X,{messages:k,chatMaxWidthClass:q}):(0,t.jsx)(z,{setInput:I,chatMaxWidthClass:q,welcomeMessage:b}),(0,t.jsx)(S,{trackVisibility:_})]}),(0,t.jsx)(C,{onSubmit:P,className:"fixed inset-x-0 bottom-0",id:o,stop:()=>{Z()},reload:A,input:R,setInput:I,chatMaxWidthClass:q})]})})}):(0,t.jsx)(em.cg,{})})},73033:function(e,n,l){l.d(n,{s:function(){return r}});var t=l(3546),s=l(52991);let r=(0,t.memo)(s.D,(e,n)=>e.children===n.children&&e.className===n.className)},52569:function(e,n,l){l.d(n,{Y:function(){return j},n:function(){return b}});var t=l(36164),s=l(3546),r=l(87782),a=l(21454),i=l(36327),o=l(98454),c=l(3765),d=l(74248),u=l(66612);let m=s.forwardRef((e,n)=>{let{className:l,...s}=e;return(0,t.jsx)(u.fC,{ref:n,className:(0,d.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",l),...s})});m.displayName=u.fC.displayName;let v=s.forwardRef((e,n)=>{let{className:l,...s}=e;return(0,t.jsx)(u.Ee,{ref:n,className:(0,d.cn)("aspect-square h-full w-full",l),...s})});v.displayName=u.Ee.displayName;let h=s.forwardRef((e,n)=>{let{className:l,...s}=e;return(0,t.jsx)(u.NY,{ref:n,className:(0,d.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",l),...s})});h.displayName=u.NY.displayName;var f=l(3448),x=l(30410).lW;let p="not_found",g=!0;function j(e){var n,l,a,u;let{className:j,fallback:b}=e,[{data:w}]=(0,o.P)(),N=null==w?void 0:w.me.id,y=N&&"/avatar/".concat(w.me.id)||null,{data:k,isLoading:C,error:E}=(0,i.Z)(y,e=>{if(g)return(0,c.Z)(e,{responseFormatter:async e=>{let n=await e.blob(),l=x.from(await n.arrayBuffer());return"data:image/png;base64,".concat(l.toString("base64"))},errorHandler:e=>{if(404===e.status)throw Error(p)}})}),S=s.useMemo(()=>{var e;if(null==w?void 0:null===(e=w.me)||void 0===e?void 0:e.email)return(0,r.B)(w.me.email)},[null==w?void 0:null===(n=w.me)||void 0===n?void 0:n.email]);return C?(0,t.jsx)(f.O,{className:(0,d.cn)("h-16 w-16 rounded-full",j)}):((null==E?void 0:E.message)===p&&(g=!1),k||S||!b)?!k&&S?(0,t.jsx)(r.Z,{className:(0,d.cn)("h-16 w-16",j),...S}):(0,t.jsxs)(m,{className:(0,d.cn)("h-16 w-16",j),children:[(0,t.jsx)(v,{src:k,alt:null==w?void 0:null===(l=w.me)||void 0===l?void 0:l.email,className:"object-cover"}),(0,t.jsx)(h,{children:null==w?void 0:null===(u=w.me)||void 0===u?void 0:null===(a=u.email)||void 0===a?void 0:a.substring(0,2)})]}):b}let b=e=>{g=!0,(0,a.JG)("/avatar/".concat(e))}}}]);